---
- hosts: all
  tags: apt
  tasks:
    - name: install aptitude
      apt: name=aptitude state=present

- hosts: all
  tags: upgrade
  tasks:
    - name: safe-upgrade
      apt: update_cache=yes cache_valid_time=86400 upgrade=yes

- hosts: all
  tags: cleanup
  tasks:
    - name: purge
      shell: for i in `dpkg --list|egrep '^rc'|awk '{print $2}'` ; do dpkg -P $i ; done

    - name: autoclean
      command: apt-get -y autoclean

    - name: autoremove
      command: apt-get -y autoremove

    - name: clean
      command: apt-get clean
