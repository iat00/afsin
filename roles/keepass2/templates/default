server {
    listen 80 default_server;
    access_log off;
    return 302 https://$http_host$request_uri;
}

server {
    listen 443 ssl;
    server_name {{ inventory_hostname }}.{{ domain }};

    root /home/afsin/secure;

    # j2
    ssl_certificate     /etc/nginx/ssl/{{ inventory_hostname }}.{{ domain }}.crt;
    ssl_certificate_key /etc/nginx/ssl/{{ inventory_hostname }}.{{ domain }}.key;

    location / {
        auth_basic "Restricted";
        auth_basic_user_file "/etc/nginx/htpasswd";

        dav_methods PUT DELETE MOVE COPY;
        dav_access group:rw all:r;
    }
}
